<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>meshed.makers &mdash; meshed 0.1.89 documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/toggleprompt.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="meshed.scrap" href="scrap.html" />
    <link rel="prev" title="meshed.itools" href="itools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> meshed
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../meshed.html">meshed</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">meshed.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">meshed.caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="composition.html">meshed.composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="dag.html">meshed.dag</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/online_marketing.html">meshed.examples.online_marketing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/price_elasticity.html">meshed.examples.price_elasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/vaccine_vs_no_vaccine.html">meshed.examples.vaccine_vs_no_vaccine</a></li>
<li class="toctree-l1"><a class="reference internal" href="ext.html">meshed.ext</a></li>
<li class="toctree-l1"><a class="reference internal" href="ext/gk.html">meshed.ext.gk</a></li>
<li class="toctree-l1"><a class="reference internal" href="ext/gk_tests.html">meshed.ext.gk_tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="itools.html">meshed.itools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">meshed.makers</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap.html">meshed.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/cached_dag.html">meshed.scrap.cached_dag</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/dask_graph_language.html">meshed.scrap.dask_graph_language</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/gk_with_networkx.html">meshed.scrap.gk_with_networkx</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/misc_utils.html">meshed.scrap.misc_utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/wrapping_dags.html">meshed.scrap.wrapping_dags</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests.html">meshed.tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_base.html">meshed.tests.test_base</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_caching.html">meshed.tests.test_caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_composition.html">meshed.tests.test_composition</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dag.html">meshed.tests.test_dag</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dag_2.html">meshed.tests.test_dag_2</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dag_defaults.html">meshed.tests.test_dag_defaults</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dag_variadics.html">meshed.tests.test_dag_variadics</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_getitem.html">meshed.tests.test_getitem</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_itools.html">meshed.tests.test_itools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_makers.html">meshed.tests.test_makers</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_util.html">meshed.tests.test_util</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/utils_for_testing.html">meshed.tests.utils_for_testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">meshed.util</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">meshed</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>meshed.makers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module_docs/meshed/makers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-meshed.makers">
<span id="meshed-makers"></span><h1>meshed.makers<a class="headerlink" href="#module-meshed.makers" title="Permalink to this headline">¶</a></h1>
<p>Makers</p>
<p>This module contains tools to make meshed objects in different ways.</p>
<p>Let’s start with an example where we have some code representing a user story:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">user_story</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">wfs</span> <span class="o">=</span> <span class="n">call</span><span class="p">(</span><span class="n">src_to_wf</span><span class="p">,</span> <span class="n">data_src</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">chks_iter</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">chunker</span><span class="p">,</span> <span class="n">wfs</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">chks</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="n">chks_iter</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">fvs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">featurizer</span><span class="p">,</span> <span class="n">chks</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">model_outputs</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fvs</span><span class="p">)</span>
</pre></div>
</div>
<p>If the code is compliant (has only function calls and assignments of their result),
we can extract <code class="docutils literal notranslate"><span class="pre">FuncNode</span></code> factories from these lines (uses AST behind the scenes).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.makers</span> <span class="kn">import</span> <span class="n">src_to_func_node_factory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fnodes_factories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">src_to_func_node_factory</span><span class="p">(</span><span class="n">user_story</span><span class="p">))</span>
</pre></div>
</div>
<p>Each factory is a curried version of <code class="docutils literal notranslate"><span class="pre">FuncNode</span></code>, set up to be able to make a <code class="docutils literal notranslate"><span class="pre">DAG</span></code>
equivalent to the user story, once we provide the necessary functions (<code class="docutils literal notranslate"><span class="pre">call</span></code>,
<code class="docutils literal notranslate"><span class="pre">map</span></code>, and <code class="docutils literal notranslate"><span class="pre">chain</span></code>).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<span class="gp">... </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">partial</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">FuncNode</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fnodes_factories</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>See that the <code class="docutils literal notranslate"><span class="pre">FuncNode</span></code> factories are all set up with
<code class="docutils literal notranslate"><span class="pre">name</span></code> (id),
<code class="docutils literal notranslate"><span class="pre">out</span></code> (output variable name),
<code class="docutils literal notranslate"><span class="pre">bind</span></code> (names of the variables where the function will source it’s arguments), and
<code class="docutils literal notranslate"><span class="pre">func_label</span></code> (which can be used when displaying the DAG, or as a key to the function
to use).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">keywords</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fnodes_factories</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;call&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="s1">&#39;wfs&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;src_to_wf&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;data_src&#39;</span><span class="p">},</span>
<span class="gp">... </span>  <span class="s1">&#39;func_label&#39;</span><span class="p">:</span> <span class="s1">&#39;call&#39;</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="s1">&#39;chks_iter&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;chunker&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;wfs&#39;</span><span class="p">},</span>
<span class="gp">... </span>  <span class="s1">&#39;func_label&#39;</span><span class="p">:</span> <span class="s1">&#39;map&#39;</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;chain&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="s1">&#39;chks&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;chks_iter&#39;</span><span class="p">},</span>
<span class="gp">... </span>  <span class="s1">&#39;func_label&#39;</span><span class="p">:</span> <span class="s1">&#39;chain&#39;</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;map_04&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="s1">&#39;fvs&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;featurizer&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;chks&#39;</span><span class="p">},</span>
<span class="gp">... </span>  <span class="s1">&#39;func_label&#39;</span><span class="p">:</span> <span class="s1">&#39;map&#39;</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;map_05&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;out&#39;</span><span class="p">:</span> <span class="s1">&#39;model_outputs&#39;</span><span class="p">,</span>
<span class="gp">... </span>  <span class="s1">&#39;bind&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;fvs&#39;</span><span class="p">},</span>
<span class="gp">... </span>  <span class="s1">&#39;func_label&#39;</span><span class="p">:</span> <span class="s1">&#39;map&#39;</span><span class="p">}</span>
<span class="gp">... </span><span class="p">]</span>
</pre></div>
</div>
<p>What can we do with that?</p>
<p>Well, provide the functions, so the DAG can actually compute.</p>
<p>You can do it yourself, or get a little help with <code class="docutils literal notranslate"><span class="pre">mk_fnodes_from_fn_factories</span></code>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.dag</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.makers</span> <span class="kn">import</span> <span class="n">mk_fnodes_from_fn_factories</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fnodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mk_fnodes_from_fn_factories</span><span class="p">(</span><span class="n">fnodes_factories</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">fnodes</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">synopsis_string</span><span class="p">())</span>
<span class="go">src_to_wf,data_src -&gt; call -&gt; wfs</span>
<span class="go">chunker,wfs -&gt; map -&gt; chks_iter</span>
<span class="go">chks_iter -&gt; chain -&gt; chks</span>
<span class="go">featurizer,chks -&gt; map_04 -&gt; fvs</span>
<span class="go">model,fvs -&gt; map_05 -&gt; model_outputs</span>
</pre></div>
</div>
<p>Wait! But we didn’t actually provide the functions we wanted to use!
What happened?!?
What happened is that <code class="docutils literal notranslate"><span class="pre">mk_fnodes_from_fn_factories</span></code> just made some for us.
It used the convenient <code class="docutils literal notranslate"><span class="pre">meshed.util.mk_place_holder_func</span></code> which makes a function
(that happens to actually compute something and be picklable).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">signature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">dag</span><span class="p">))</span>
<span class="go">&#39;(src_to_wf, data_src, chunker, featurizer, model)&#39;</span>
</pre></div>
</div>
<p>We can actually call the <code class="docutils literal notranslate"><span class="pre">dag</span></code> and get something meaningful:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dag</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">&#39;map(model=5, fvs=map(featurizer=4, chks=chain(chks_iter=map(chunker=3, wfs=call(src_to_wf=1, data_src=2)))))&#39;</span>
</pre></div>
</div>
<p>If you don’t want <code class="docutils literal notranslate"><span class="pre">mk_fnodes_from_fn_factories</span></code> to do that (because you are in
prod and need to make sure as much as possible is explicitly as expected, you can
simply use a different <code class="docutils literal notranslate"><span class="pre">factory_to_func</span></code> argument. The default one is:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.makers</span> <span class="kn">import</span> <span class="n">dlft_factory_to_func</span>
</pre></div>
</div>
<p>which you can also reuse to make your own.
See below how we provide a <code class="docutils literal notranslate"><span class="pre">name_to_func_map</span></code> to specify how <code class="docutils literal notranslate"><span class="pre">func_label``s</span> <span class="pre">should</span>
<span class="pre">map</span> <span class="pre">to</span> <span class="pre">actual</span> <span class="pre">functions,</span> <span class="pre">and</span> <span class="pre">set</span> <span class="pre">``use_place_holder_fallback=False</span></code> to make
sure that we don’t ever fallback on a placeholder function as we did above.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># would use operator.methodcaller(&#39;__call__&#39;) but doesn&#39;t have a __name__</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">_chain</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">factory_to_func</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">dlft_factory_to_func</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">name_to_func_map</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;map&#39;</span><span class="p">:</span> <span class="n">_map</span><span class="p">,</span> <span class="s1">&#39;chain&#39;</span><span class="p">:</span> <span class="n">_chain</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">:</span> <span class="n">_call</span><span class="p">},</span>
<span class="gp">... </span>    <span class="n">use_place_holder_fallback</span><span class="o">=</span><span class="kc">False</span>
<span class="gp">... </span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fnodes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">mk_fnodes_from_fn_factories</span><span class="p">(</span><span class="n">fnodes_factories</span><span class="p">,</span> <span class="n">factory_to_func</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dag</span> <span class="o">=</span> <span class="n">DAG</span><span class="p">(</span><span class="n">fnodes</span><span class="p">)</span>
</pre></div>
</div>
<p>On the surface, we get the same dag as we had before – at least from the point of view
of the dag signature, names, and relationships between these names:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">synopsis_string</span><span class="p">())</span>
<span class="go">src_to_wf,data_src -&gt; call -&gt; wfs</span>
<span class="go">chunker,wfs -&gt; map -&gt; chks_iter</span>
<span class="go">chks_iter -&gt; chain -&gt; chks</span>
<span class="go">featurizer,chks -&gt; map_04 -&gt; fvs</span>
<span class="go">model,fvs -&gt; map_05 -&gt; model_outputs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">dag</span><span class="p">))</span>
<span class="go">&#39;(src_to_wf, data_src, chunker, featurizer, model)&#39;</span>
</pre></div>
</div>
<p>But see below that the dag is now using the functions we specified:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># dag(src_to_wf=1, data_src=2, chunker=3, featurizer=4, model=5)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># will trigger this:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># src_to_wf=1, data_src=2 -&gt; call -&gt; wfs == 1 + 2 == 3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># chunker=3 , wfs=3 -&gt; map -&gt; chks_iter == [3, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># chks_iter=6 -&gt; chain -&gt; chks == 3 + 3 == 6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># featurizer=4, chks=6 -&gt; map_04 -&gt; fvs == [4, 6]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># model=5, fvs=[4, 6] -&gt; map_05 -&gt; model_outputs == [5, [4, 6]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dag</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="go">[5, [4, 6]]</span>
</pre></div>
</div>
<dl class="py function">
<dt id="meshed.makers.dlft_factory_to_func">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">dlft_factory_to_func</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">factory</span><span class="p">:</span> <span class="n">functools.partial</span></em>, <em class="sig-param"><span class="n">name_to_func_map</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>Dict<span class="p">[</span>str<span class="p">, </span>Callable<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">use_place_holder_fallback</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/meshed/makers.html#dlft_factory_to_func"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.dlft_factory_to_func" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a function for the given factory, using</p>
</dd></dl>

<dl class="py class">
<dt id="meshed.makers.dlft_factory_to_func_mapping">
<em class="property">class </em><code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">dlft_factory_to_func_mapping</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwds</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/meshed/makers.html#dlft_factory_to_func_mapping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.dlft_factory_to_func_mapping" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="meshed.makers.mk_fnodes_from_fn_factories">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">mk_fnodes_from_fn_factories</code><span class="sig-paren">(</span><em class="sig-param">fnodes_factories: Iterable[Callable[[...], meshed.base.FuncNode]], factory_to_func: Callable[[Callable[[...], meshed.base.FuncNode]], Callable] = &lt;function dlft_factory_to_func&gt;</em><span class="sig-paren">)</span> &#x2192; Iterator<span class="p">[</span><a class="reference internal" href="base.html#meshed.base.FuncNode" title="meshed.base.FuncNode">meshed.base.FuncNode</a><span class="p">]</span><a class="reference internal" href="../../_modules/meshed/makers.html#mk_fnodes_from_fn_factories"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.mk_fnodes_from_fn_factories" title="Permalink to this definition">¶</a></dt>
<dd><p>Make func nodes from func node factories and a specification of how to make the
nodes from these.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fnodes_factories</strong> – An iterable of FuncNodeFactory</p></li>
<li><p><strong>factory_to_func</strong> – A function that will give you a function given a
FuncNodeFactory input (where it will draw the information it needs to know
what kind of function to make).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="meshed.makers.parse_assignment_steps">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">parse_assignment_steps</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/meshed/makers.html#parse_assignment_steps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.parse_assignment_steps" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse source code and generate tuples of information about it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>src</strong> – The source string or a python object whose code string can be extracted.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>And generator of “target_values”</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.makers</span> <span class="kn">import</span> <span class="n">parse_assignment_steps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="n">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">func2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_assignment_steps</span><span class="p">(</span><span class="n">foo</span><span class="p">))</span>
</pre></div>
</div>
<p>Let’s look at the first target_value to see what it contains:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span><span class="p">,</span> <span class="n">call</span> <span class="o">=</span> <span class="n">target_values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># a 2-tuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>  <span class="c1"># the first element is a ast Name object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<span class="go">[&#39;col_offset&#39;, &#39;ctx&#39;, &#39;end_col_offset&#39;, &#39;end_lineno&#39;, &#39;id&#39;, &#39;lineno&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">name</span><span class="o">.</span><span class="n">id</span>
<span class="go">&#39;x&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">)</span>  <span class="c1"># the first element is a ast Call object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">sorted</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">call</span><span class="p">))</span>
<span class="go">[&#39;args&#39;, &#39;col_offset&#39;, &#39;end_col_offset&#39;, &#39;end_lineno&#39;, &#39;func&#39;, &#39;keywords&#39;, &#39;lineno&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">call</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
<span class="go">&#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">call</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">arg</span>
<span class="go">&#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">call</span><span class="o">.</span><span class="n">keywords</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Basically, these ast objects contain all we need to know about the (parsed) source.</p>
</dd></dl>

<dl class="py function">
<dt id="meshed.makers.parsed_to_node_kwargs">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">parsed_to_node_kwargs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">target_value</span></em><span class="sig-paren">)</span> &#x2192; Iterator<span class="p">[</span>dict<span class="p">]</span><a class="reference internal" href="../../_modules/meshed/makers.html#parsed_to_node_kwargs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.parsed_to_node_kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract FuncNode kwargs (name, out, and bind) from ast (target,value) pairs</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>target_value</strong> – A (target, value) pair</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <code class="docutils literal notranslate"><span class="pre">{name:...,</span> <span class="pre">out:...,</span> <span class="pre">bind:...}</span></code> dict (meant to be used to curry FuncNode</p>
</dd>
</dl>
<p>Where can you make make target_values? With the <code class="docutils literal notranslate"><span class="pre">parse_assignment_steps</span></code> function.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">meshed.makers</span> <span class="kn">import</span> <span class="n">parse_assignment_steps</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>    <span class="n">x</span> <span class="o">=</span> <span class="n">func1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">y</span> <span class="o">=</span> <span class="n">func2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">func1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">target_value</span> <span class="ow">in</span> <span class="n">parse_assignment_steps</span><span class="p">(</span><span class="n">foo</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">parsed_to_node_kwargs</span><span class="p">(</span><span class="n">target_value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">{&#39;name&#39;: &#39;func1&#39;, &#39;out&#39;: &#39;x&#39;, &#39;bind&#39;: {0: &#39;a&#39;, &#39;b&#39;: 2}}</span>
<span class="go">{&#39;name&#39;: &#39;func2&#39;, &#39;out&#39;: &#39;y&#39;, &#39;bind&#39;: {0: &#39;x&#39;, 1: &#39;func1&#39;, &#39;c&#39;: 3, &#39;d&#39;: &#39;x&#39;}}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="meshed.makers.signed_itemgetter">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">signed_itemgetter</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">keys</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/meshed/makers.html#signed_itemgetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.signed_itemgetter" title="Permalink to this definition">¶</a></dt>
<dd><p>Like <code class="docutils literal notranslate"><span class="pre">operator.itemgetter</span></code>, except has a signature, which we needed</p>
</dd></dl>

<dl class="py function">
<dt id="meshed.makers.src_to_func_node_factory">
<code class="sig-prename descclassname">meshed.makers.</code><code class="sig-name descname">src_to_func_node_factory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">src</span></em>, <em class="sig-param"><span class="n">exclude_names</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Iterator<span class="p">[</span>Union<span class="p">[</span><a class="reference internal" href="base.html#meshed.base.FuncNode" title="meshed.base.FuncNode">meshed.base.FuncNode</a><span class="p">, </span>Callable<span class="p">[</span><span class="p">[</span><span class="p">…</span><span class="p">]</span><span class="p">, </span><a class="reference internal" href="base.html#meshed.base.FuncNode" title="meshed.base.FuncNode">meshed.base.FuncNode</a><span class="p">]</span><span class="p">]</span><span class="p">]</span><a class="reference internal" href="../../_modules/meshed/makers.html#src_to_func_node_factory"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#meshed.makers.src_to_func_node_factory" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> – Callable or string of callable.</p></li>
<li><p><strong>exclude_names</strong> – Names to exclude when making func_nodes</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="itools.html" class="btn btn-neutral float-left" title="meshed.itools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="scrap.html" class="btn btn-neutral float-right" title="meshed.scrap" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>